<app-page-header
  [title]="'admin.title' | translate"
  [subtitle]="'admin.subtitle' | translate"
></app-page-header>

<div class="grid">
  <div class="col-12 lg:col-6">
    <div class="card-surface p-3">
      <p-table [value]="(usuarios$ | async) ?? []" selectionMode="single" (onRowSelect)="handleRowSelect($event)">
        <ng-template pTemplate="header">
          <tr>
            <th>{{ 'admin.usuario' | translate }}</th>
            <th>{{ 'admin.rol' | translate }}</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
          <tr>
            <td>{{ user.nombre }}</td>
            <td>{{ roleLabel(user.rol) }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <div class="col-12 lg:col-6">
    <div class="card-surface p-4" *ngIf="selectedUser as user; else emptyAdmin">
      <h3>{{ user.nombre }}</h3>
      <div class="flex flex-column gap-2 mt-3">
        <label>{{ 'admin.rol' | translate }}</label>
        <p-select
          [options]="rolesOptions"
          optionLabel="label"
          optionValue="value"
          [(ngModel)]="user.rol"
          (onChange)="onRoleChange($event.value)"
          [disabled]="!canEdit"
        ></p-select>
      </div>
      <div class="mt-4">
        <h4>{{ 'admin.permisos' | translate }}</h4>
        <div class="flex flex-column gap-3 mt-2">
          <div *ngFor="let group of permissionGroups" class="flex flex-column gap-2">
            <strong>{{ group.labelKey | translate }}</strong>
            <div class="flex flex-column gap-2">
              <div class="flex align-items-center gap-2" *ngFor="let permiso of group.items">
                <p-checkbox
                  [(ngModel)]="permisos[permiso.key]"
                  [binary]="true"
                  [disabled]="!canEdit"
                  inputId="{{ permiso.key }}"
                ></p-checkbox>
                <label for="{{ permiso.key }}">{{ permiso.labelKey | translate }}</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button pButton type="button" class="mt-3" (click)="save()" [disabled]="!canEdit">
        {{ 'app.guardar' | translate }}
      </button>
    </div>
    <ng-template #emptyAdmin>
      <div class="card-surface p-4 text-center app-muted">
        {{ 'admin.seleccionar' | translate }}
      </div>
    </ng-template>
  </div>
</div>
